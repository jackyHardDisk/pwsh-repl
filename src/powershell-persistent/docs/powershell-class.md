# PowerShell Class

## Definition

- Namespace:
    - [System.Management.Automation](system.management.automation?view=powershellsdk-7.4.0)

- Assembly:
    - System.Management.Automation.dll

- Package:
    - Microsoft.PowerShell.5.1.ReferenceAssemblies v1.0.0

- Package:
    - System.Management.Automation v7.0.13

- Package:
    - System.Management.Automation v7.1.7

- Package:
    - System.Management.Automation v7.2.12

- Package:
    - System.Management.Automation v7.3.5

- Package:
    - System.Management.Automation v7.4.0

- Package:
    - Microsoft.WSMan.Runtime v6.1.0

- Package:
    - Microsoft.WSMan.Runtime v6.2.0

Represents a PowerShell command or script to execute against a Runspace(Pool) if provided, otherwise execute using a default Runspace. Provides access to different result buffers like output, error, debug, verbose, progress, warning, and information.

Provides a simple interface to execute a powershell command:

```
Powershell.Create().AddScript("get-process").Invoke();
```

The above statement creates a local runspace using default configuration, executes the command and then closes the runspace.

Using RunspacePool property, the caller can provide the runspace where the command / script is executed.

```cpp
public ref class PowerShell sealed : IDisposable
```

```csharp
public sealed class PowerShell : IDisposable
```

```fsharp
type PowerShell = class
    interface IDisposable
```

```vb
Public NotInheritable Class PowerShell
Implements IDisposable
```

- Inheritance
    - [Object](/en-us/dotnet/api/system.object)
PowerShell

- Implements
    - [IDisposable](/en-us/dotnet/api/system.idisposable)

## Properties

| [Commands](system.management.automation.powershell.commands?view=powershellsdk-7.4.0#system-management-automation-powershell-commands) | Gets or sets current powershell command line. |
| --- | --- |
| [HadErrors](system.management.automation.powershell.haderrors?view=powershellsdk-7.4.0#system-management-automation-powershell-haderrors) | If an error occurred while executing the pipeline, this will be set to true. |
| [HistoryString](system.management.automation.powershell.historystring?view=powershellsdk-7.4.0#system-management-automation-powershell-historystring) | The history string to be used for displaying the history. |
| [InstanceId](system.management.automation.powershell.instanceid?view=powershellsdk-7.4.0#system-management-automation-powershell-instanceid) | Get unique id for this instance of runspace pool. It is primarily used for logging purposes. |
| [InvocationStateInfo](system.management.automation.powershell.invocationstateinfo?view=powershellsdk-7.4.0#system-management-automation-powershell-invocationstateinfo) | Gets the execution state of the current PowerShell instance. |
| [IsNested](system.management.automation.powershell.isnested?view=powershellsdk-7.4.0#system-management-automation-powershell-isnested) | Gets the property which indicates if this PowerShell instance is nested. |
| [IsRunspaceOwner](system.management.automation.powershell.isrunspaceowner?view=powershellsdk-7.4.0#system-management-automation-powershell-isrunspaceowner) | Indicates if this PowerShell object is the owner of the runspace or RunspacePool assigned to this object. |
| [Runspace](system.management.automation.powershell.runspace?view=powershellsdk-7.4.0#system-management-automation-powershell-runspace) | Sets an associated Runspace for this PowerShell instance. This can be null in which case a new runspace is created whenever Invoke\* method is called. |
| [RunspacePool](system.management.automation.powershell.runspacepool?view=powershellsdk-7.4.0#system-management-automation-powershell-runspacepool) | Sets an associated RunspacePool for this PowerShell instance. A Runspace from this pool is used whenever Invoke\* method is called.<br><br>This can be null in which case a new runspace is created whenever Invoke\* method is called. |
| [Streams](system.management.automation.powershell.streams?view=powershellsdk-7.4.0#system-management-automation-powershell-streams) | Streams generated by PowerShell invocations. |

## Methods

| [AddArgument(Object)](system.management.automation.powershell.addargument?view=powershellsdk-7.4.0#system-management-automation-powershell-addargument%28system-object%29) | Adds an argument to the last added command. For example, to construct a command string "get-process \| select-object name"<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").<br>                            AddCommand("select-object").AddParameter("name");<br>```<br><br>This will add the value "name" to the positional parameter list of "select-object" cmdlet. When the command is invoked, this value will get bound to positional parameter 0 of the "select-object" cmdlet which is "Property". |
| --- | --- |
| [AddCommand(CommandInfo)](system.management.automation.powershell.addcommand?view=powershellsdk-7.4.0#system-management-automation-powershell-addcommand%28system-management-automation-commandinfo%29) | CommandInfo object for the command to add. |
| [AddCommand(String, Boolean)](system.management.automation.powershell.addcommand?view=powershellsdk-7.4.0#system-management-automation-powershell-addcommand%28system-string-system-boolean%29) | Add a cmdlet to construct a command pipeline. For example, to construct a command string "get-process \| sort-object",<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").AddCommand("sort-object");<br>``` |
| [AddCommand(String)](system.management.automation.powershell.addcommand?view=powershellsdk-7.4.0#system-management-automation-powershell-addcommand%28system-string%29) | Add a cmdlet to construct a command pipeline. For example, to construct a command string "get-process \| sort-object",<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").AddCommand("sort-object");<br>``` |
| [AddParameter(String, Object)](system.management.automation.powershell.addparameter?view=powershellsdk-7.4.0#system-management-automation-powershell-addparameter%28system-string-system-object%29) | Add a parameter to the last added command. For example, to construct a command string "get-process \| select-object -property name"<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").<br>                            AddCommand("select-object").AddParameter("property","name");<br>``` |
| [AddParameter(String)](system.management.automation.powershell.addparameter?view=powershellsdk-7.4.0#system-management-automation-powershell-addparameter%28system-string%29) | Adds a switch parameter to the last added command. For example, to construct a command string "get-process \| sort-object -descending"<br><br><br>```<br>PSCommand command = new PSCommand("get-process").<br>                            AddCommand("sort-object").AddParameter("descending");<br>``` |
| [AddParameters(IDictionary)](system.management.automation.powershell.addparameters?view=powershellsdk-7.4.0#system-management-automation-powershell-addparameters%28system-collections-idictionary%29) | Adds a set of parameters to the last added command. |
| [AddParameters(IList)](system.management.automation.powershell.addparameters?view=powershellsdk-7.4.0#system-management-automation-powershell-addparameters%28system-collections-ilist%29) | Adds a set of parameters to the last added command. |
| [AddScript(String, Boolean)](system.management.automation.powershell.addscript?view=powershellsdk-7.4.0#system-management-automation-powershell-addscript%28system-string-system-boolean%29) | Add a piece of script to construct a command pipeline. For example, to construct a command string "get-process \| foreach { $\_.Name }"<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").<br>                            AddCommand("foreach { $_.Name }", true);<br>``` |
| [AddScript(String)](system.management.automation.powershell.addscript?view=powershellsdk-7.4.0#system-management-automation-powershell-addscript%28system-string%29) | Add a piece of script to construct a command pipeline. For example, to construct a command string "get-process \| foreach { $\_.Name }"<br><br><br>```<br>PowerShell shell = PowerShell.Create("get-process").<br>                            AddCommand("foreach { $_.Name }", true);<br>``` |
| [AddStatement()](system.management.automation.powershell.addstatement?view=powershellsdk-7.4.0#system-management-automation-powershell-addstatement) | Adds an additional statement for execution<br><br>For example,<br><br><br>```<br>Runspace rs = RunspaceFactory.CreateRunspace();<br>PowerShell ps = PowerShell.Create();<br><br>ps.Runspace = rs;<br>ps.AddCommand("Get-Process").AddArgument("idle");<br>ps.AddStatement().AddCommand("Get-Service").AddArgument("audiosrv");<br>ps.Invoke();<br>``` |
| [AsJobProxy()](system.management.automation.powershell.asjobproxy?view=powershellsdk-7.4.0#system-management-automation-powershell-asjobproxy) | Returns a job object which can be used to control the invocation of the command with AsJob Parameter |
| [BeginInvoke()](system.management.automation.powershell.begininvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-begininvoke) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) asynchronously. Use EndInvoke() to obtain the output of the command. |
| [BeginInvoke&lt;T&gt;(PSDataCollection&lt;T&gt;, PSInvocationSettings, AsyncCallback, Object)](system.management.automation.powershell.begininvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-begininvoke-1%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psinvocationsettings-system-asynccallback-system-object%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) asynchronously. Use EndInvoke() to obtain the output of the command. |
| [BeginInvoke&lt;T&gt;(PSDataCollection&lt;T&gt;)](system.management.automation.powershell.begininvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-begininvoke-1%28system-management-automation-psdatacollection%28%28-0%29%29%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) asynchronously. Use EndInvoke() to obtain the output of the command. |
| [BeginInvoke&lt;TInput,TOutput&gt;(PSDataCollection&lt;TInput&gt;, PSDataCollection&lt;TOutput&gt;, PSInvocationSettings, AsyncCallback, Object)](system.management.automation.powershell.begininvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-begininvoke-2%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psdatacollection%28%28-1%29%29-system-management-automation-psinvocationsettings-system-asynccallback-system-object%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) asynchronously and collect output data into the buffer `output`. When this method is used EndInvoke() returns a null buffer. |
| [BeginInvoke&lt;TInput,TOutput&gt;(PSDataCollection&lt;TInput&gt;, PSDataCollection&lt;TOutput&gt;)](system.management.automation.powershell.begininvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-begininvoke-2%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psdatacollection%28%28-1%29%29%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) asynchronously. When this method is used EndInvoke() returns a null buffer. |
| [BeginStop(AsyncCallback, Object)](system.management.automation.powershell.beginstop?view=powershellsdk-7.4.0#system-management-automation-powershell-beginstop%28system-asynccallback-system-object%29) | Stop the currently running command asynchronously. If the command is not started, the state of PowerShell instance is changed to Stopped and corresponding events will be raised.<br><br>The returned IAsyncResult object can be used to wait for the stop operation to complete. |
| [Connect()](system.management.automation.powershell.connect?view=powershellsdk-7.4.0#system-management-automation-powershell-connect) | Synchronously connects to a running command on a remote server. |
| [ConnectAsync()](system.management.automation.powershell.connectasync?view=powershellsdk-7.4.0#system-management-automation-powershell-connectasync) | Asynchronously connects to a running command on a remote server. The returned IAsyncResult object can be used with EndInvoke() method to wait on command and/or get command returned data. |
| [ConnectAsync(PSDataCollection&lt;PSObject&gt;, AsyncCallback, Object)](system.management.automation.powershell.connectasync?view=powershellsdk-7.4.0#system-management-automation-powershell-connectasync%28system-management-automation-psdatacollection%28%28system-management-automation-psobject%29%29-system-asynccallback-system-object%29) | Asynchronously connects to a running command on a remote server. The returned IAsyncResult object can be used with EndInvoke() method to wait on command and/or get command returned data. |
| [Create()](system.management.automation.powershell.create?view=powershellsdk-7.4.0#system-management-automation-powershell-create) | Constructs an empty PowerShell instance; a script or command must be added before invoking this instance. |
| [Create(InitialSessionState)](system.management.automation.powershell.create?view=powershellsdk-7.4.0#system-management-automation-powershell-create%28system-management-automation-runspaces-initialsessionstate%29) | Constructs an empty PowerShell instance; a script or command must be added before invoking this instance. |
| [Create(Runspace)](system.management.automation.powershell.create?view=powershellsdk-7.4.0#system-management-automation-powershell-create%28system-management-automation-runspaces-runspace%29) | Constructs an empty PowerShell instance and associates it with the provided Runspace; a script or command must be added before invoking this instance. |
| [Create(RunspaceMode)](system.management.automation.powershell.create?view=powershellsdk-7.4.0#system-management-automation-powershell-create%28system-management-automation-runspacemode%29) | Constructs an empty PowerShell instance; a script or command must be added before invoking this instance. |
| [CreateNestedPowerShell()](system.management.automation.powershell.createnestedpowershell?view=powershellsdk-7.4.0#system-management-automation-powershell-createnestedpowershell) | Creates a nested powershell within the current instance. Nested PowerShell is used to do simple operations like checking state of a variable while another command is using the runspace.<br><br>Nested PowerShell should be invoked from the same thread as the parent PowerShell invocation thread. So effectively the parent Powershell invocation thread is blocked until nested invoke() operation is complete.<br><br>Implement PSHost.EnterNestedPrompt to perform invoke() operation on the nested powershell. |
| [Dispose()](system.management.automation.powershell.dispose?view=powershellsdk-7.4.0#system-management-automation-powershell-dispose) | Dispose all managed resources. This will suppress finalizer on the object from getting called by calling System.GC.SuppressFinalize(this). |
| [EndInvoke(IAsyncResult)](system.management.automation.powershell.endinvoke?view=powershellsdk-7.4.0#system-management-automation-powershell-endinvoke%28system-iasyncresult%29) | Waits for the pending asynchronous BeginInvoke to complete. |
| [EndStop(IAsyncResult)](system.management.automation.powershell.endstop?view=powershellsdk-7.4.0#system-management-automation-powershell-endstop%28system-iasyncresult%29) | Waits for the pending asynchronous BeginStop to complete. |
| [GetSteppablePipeline()](system.management.automation.powershell.getsteppablepipeline?view=powershellsdk-7.4.0#system-management-automation-powershell-getsteppablepipeline) | Get a steppable pipeline object. |
| [Invoke()](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output PSObject collection. |
| [Invoke(IEnumerable, PSInvocationSettings)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke%28system-collections-ienumerable-system-management-automation-psinvocationsettings%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output PSObject collection. |
| [Invoke(IEnumerable)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke%28system-collections-ienumerable%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output PSObject collection. |
| [Invoke&lt;T&gt;()](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-1) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output. |
| [Invoke&lt;T&gt;(IEnumerable, IList&lt;T&gt;, PSInvocationSettings)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-1%28system-collections-ienumerable-system-collections-generic-ilist%28%28-0%29%29-system-management-automation-psinvocationsettings%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and collect output data into the buffer `output` |
| [Invoke&lt;T&gt;(IEnumerable, IList&lt;T&gt;)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-1%28system-collections-ienumerable-system-collections-generic-ilist%28%28-0%29%29%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and collect output data into the buffer `output` |
| [Invoke&lt;T&gt;(IEnumerable, PSInvocationSettings)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-1%28system-collections-ienumerable-system-management-automation-psinvocationsettings%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output. |
| [Invoke&lt;T&gt;(IEnumerable)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-1%28system-collections-ienumerable%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and return the output. |
| [Invoke&lt;TInput,TOutput&gt;(PSDataCollection&lt;TInput&gt;, PSDataCollection&lt;TOutput&gt;, PSInvocationSettings)](system.management.automation.powershell.invoke?view=powershellsdk-7.4.0#system-management-automation-powershell-invoke-2%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psdatacollection%28%28-1%29%29-system-management-automation-psinvocationsettings%29) | Invoke the [Command](system.management.automation.runspaces.command?view=powershellsdk-7.4.0) synchronously and stream output data into the buffer `output` |
| [InvokeAsync()](system.management.automation.powershell.invokeasync?view=powershellsdk-7.4.0#system-management-automation-powershell-invokeasync) | Invoke a PowerShell command asynchronously. Use await to wait for the command to complete and obtain the output of the command. |
| [InvokeAsync&lt;T&gt;(PSDataCollection&lt;T&gt;, PSInvocationSettings, AsyncCallback, Object)](system.management.automation.powershell.invokeasync?view=powershellsdk-7.4.0#system-management-automation-powershell-invokeasync-1%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psinvocationsettings-system-asynccallback-system-object%29) | Invoke a PowerShell command asynchronously. Use await to wait for the command to complete and obtain the output of the command. |
| [InvokeAsync&lt;T&gt;(PSDataCollection&lt;T&gt;)](system.management.automation.powershell.invokeasync?view=powershellsdk-7.4.0#system-management-automation-powershell-invokeasync-1%28system-management-automation-psdatacollection%28%28-0%29%29%29) | Invoke a PowerShell command asynchronously. Use await to wait for the command to complete and obtain the output of the command. |
| [InvokeAsync&lt;TInput,TOutput&gt;(PSDataCollection&lt;TInput&gt;, PSDataCollection&lt;TOutput&gt;, PSInvocationSettings, AsyncCallback, Object)](system.management.automation.powershell.invokeasync?view=powershellsdk-7.4.0#system-management-automation-powershell-invokeasync-2%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psdatacollection%28%28-1%29%29-system-management-automation-psinvocationsettings-system-asynccallback-system-object%29) | Invoke a PowerShell command asynchronously and collect output data into the buffer `output`. Use await to wait for the command to complete and obtain the output of the command. |
| [InvokeAsync&lt;TInput,TOutput&gt;(PSDataCollection&lt;TInput&gt;, PSDataCollection&lt;TOutput&gt;)](system.management.automation.powershell.invokeasync?view=powershellsdk-7.4.0#system-management-automation-powershell-invokeasync-2%28system-management-automation-psdatacollection%28%28-0%29%29-system-management-automation-psdatacollection%28%28-1%29%29%29) | Invoke a PowerShell command asynchronously. Use await to wait for the command to complete and obtain the output of the command. |
| [Stop()](system.management.automation.powershell.stop?view=powershellsdk-7.4.0#system-management-automation-powershell-stop) | Stop the currently running command synchronously. |
| [StopAsync(AsyncCallback, Object)](system.management.automation.powershell.stopasync?view=powershellsdk-7.4.0#system-management-automation-powershell-stopasync%28system-asynccallback-system-object%29) | Stop a PowerShell command asynchronously. Use await to wait for the command to stop. |

## Events

| [InvocationStateChanged](system.management.automation.powershell.invocationstatechanged?view=powershellsdk-7.4.0#system-management-automation-powershell-invocationstatechanged) | Event raised when PowerShell Execution State Changes. |
| --- | --- |

## Applies to
